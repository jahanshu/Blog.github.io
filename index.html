<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>My Stylish Blog</title>
  <link rel="stylesheet" href="style.css">
</head>
<body class="light">
  <header>
    <h1>My Blog üöÄ</h1>
    <div>
      <span id="userStatus"></span>
      <button onclick="toggleTheme()">Toggle üåô/‚òÄÔ∏è</button>
    </div>
  </header>

  <div class="container">
    <!-- SIGNUP / LOGIN FORM -->
    <div id="authSection" class="card">
      <h2>Sign Up / Sign In</h2>
      <input type="text" id="username" placeholder="Username">
      <input type="password" id="password" placeholder="Password">
      <label>Upload Profile Pic: <input type="file" id="profilePic"></label>
      <button onclick="signUp()">Sign Up</button>
      <button onclick="signIn()">Sign In</button>
    </div>

    <!-- NEW POST -->
    <div id="postSection" class="card hidden">
      <h2>Create Post</h2>
      <input type="text" id="postTitle" placeholder="Post Title">
      <textarea id="postContent" placeholder="Write something..."></textarea>
      <button onclick="addPost()">Publish</button>
      <button onclick="logout()">Logout</button>
    </div>

    <!-- POSTS -->
    <div id="posts"></div>
  </div>

  <!-- Floating Instagram Button -->
<a href="https://www.instagram.com/k_jahanshu/" target="_blank" class="insta-btn">
  <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="#e1306c" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <rect x="2" y="2" width="20" height="20" rx="5" ry="5"></rect>
    <path d="M9 12a3 3 0 1 0 6 0a3 3 0 0 0 -6 0"></path>
    <path d="M16.5 7.5v.01"></path>
  </svg>
</a>

  <script>
    let currentUser = JSON.parse(localStorage.getItem("currentUser")) || null;
    let users = JSON.parse(localStorage.getItem("users")) || [];
    let posts = JSON.parse(localStorage.getItem("posts")) || [];

    function toggleTheme() {
      document.body.classList.toggle("dark");
      document.body.classList.toggle("light");
    }

    function signUp() {
      const username = document.getElementById("username").value;
      const password = document.getElementById("password").value;
      const file = document.getElementById("profilePic").files[0];

      if (!username || !password) {
        alert("Please fill all fields!");
        return;
      }
      if (users.find(u => u.username === username)) {
        alert("User already exists!");
        return;
      }
      if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
          saveUser(username, password, e.target.result);
        }
        reader.readAsDataURL(file);
      } else {
        saveUser(username, password, null);
      }
    }

    function saveUser(username, password, pic) {
      users.push({ username, password, pic });
      localStorage.setItem("users", JSON.stringify(users));
      alert("User registered! Now sign in.");
    }

    function signIn() {
      const username = document.getElementById("username").value;
      const password = document.getElementById("password").value;
      const user = users.find(u => u.username === username && u.password === password);

      if (!user) {
        alert("Invalid credentials!");
        return;
      }
      currentUser = user;
      localStorage.setItem("currentUser", JSON.stringify(user));
      updateUI();
    }

    function logout() {
      currentUser = null;
      localStorage.removeItem("currentUser");
      updateUI();
    }

    function addPost() {
      if (!currentUser) {
        alert("Login required!");
        return;
      }
      const title = document.getElementById("postTitle").value;
      const content = document.getElementById("postContent").value;
      if (!title || !content) return alert("Fill title and content!");

      posts.push({
        title,
        content,
        author: currentUser.username,
        pic: currentUser.pic,
        comments: []
      });
      localStorage.setItem("posts", JSON.stringify(posts));
      document.getElementById("postTitle").value = "";
      document.getElementById("postContent").value = "";
      renderPosts();
    }

    function addComment(index) {
      const comment = prompt("Enter your comment:");
      if (!comment) return;
      posts[index].comments.push({
        text: comment,
        author: currentUser.username,
        pic: currentUser.pic
      });
      localStorage.setItem("posts", JSON.stringify(posts));
      renderPosts();
    }

    function renderPosts() {
      const postsDiv = document.getElementById("posts");
      postsDiv.innerHTML = "";
      posts.forEach((post, i) => {
        const div = document.createElement("div");
        div.className = "card post";
        div.innerHTML = `
          <h3>${post.title}</h3>
          <p>${post.content}</p>
          <div class="post-author">
            ${post.pic ? `<img src="${post.pic}">` : ""}
            <span>by ${post.author}</span>
          </div>
          <button onclick="addComment(${i})">Comment</button>
          <div>
            ${post.comments.map(c => `
              <div class="comment">
                ${c.pic ? `<img src="${c.pic}">` : ""}
                <span><b>${c.author}:</b> ${c.text}</span>
              </div>`).join("")}
          </div>
        `;
        postsDiv.appendChild(div);
      });
    }

    function updateUI() {
      if (currentUser) {
        document.getElementById("authSection").classList.add("hidden");
        document.getElementById("postSection").classList.remove("hidden");
        document.getElementById("userStatus").innerHTML = `
          <div class="user-info">
            ${currentUser.pic ? `<img src="${currentUser.pic}">` : ""}
            Hi, ${currentUser.username}
          </div>`;
      } else {
        document.getElementById("authSection").classList.remove("hidden");
        document.getElementById("postSection").classList.add("hidden");
        document.getElementById("userStatus").innerHTML = "Not logged in";
      }
      renderPosts();
    }

    updateUI();
  </script>
</body>
</html>
